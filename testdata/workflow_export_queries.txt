CREATE TEMP TABLE tmp_mini_workflow AS (SELECT id, name, label, data, status, created_at, updated_at FROM workflow order by updated_at desc);
CREATE INDEX ON tmp_mini_workflow (id);
CREATE TEMP TABLE tmp_mini_task_config AS (SELECT name, max_concurrency, max_attempts, retry_interval_min, retry_interval_max, timeout FROM task_config WHERE TRUE);
CREATE INDEX ON tmp_mini_task_config (name);
CREATE TEMP TABLE tmp_mini_task AS (SELECT id, workflow_id, parent_task_id, task_name, global_dedup_key, priority, data, status, attempt, error, created_at, started_at, completed_at FROM task WHERE (task.task_name IN (SELECT name FROM tmp_mini_task_config)) OR (task.workflow_id IN (SELECT id FROM tmp_mini_workflow)));
CREATE INDEX ON tmp_mini_task (id);
CREATE TEMP TABLE tmp_mini_task_dependency AS (SELECT task_id, depends_on_task_id FROM task_dependency WHERE (task_dependency.depends_on_task_id IN (SELECT id FROM tmp_mini_task)) OR (task_dependency.task_id IN (SELECT id FROM tmp_mini_task)));